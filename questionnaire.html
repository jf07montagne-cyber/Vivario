<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vivario — Questionnaire</title>

  <link rel="stylesheet" href="style.css?v=600" />

  <style>
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:10px;}
    .qcard{display:grid;gap:10px;margin-top:10px;}
    .opt{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);cursor:pointer;user-select:none;}
    .opt input{margin-top:2px;}
    .opt:hover{background:rgba(255,255,255,.09);}
    .hint{font-size:12px;opacity:.78;margin-top:-4px;}
    .err{margin-top:6px;color:#ffd5d5;font-size:13px;}
    .navrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    .btnLike{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:inherit;text-decoration:none;cursor:pointer;}
    .btnLike:hover{background:rgba(255,255,255,.10);}
    .btnPrimary{background:rgba(120,160,255,.22);border:1px solid rgba(120,160,255,.35);}
    .btnPrimary:hover{background:rgba(120,160,255,.30);}
    .muted{opacity:.78;}
    .small{font-size:12px;}
    h1,h2{margin:0;}

    /* ✅ réglage coach doux */
    .miniSettings{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .toggleRow{display:flex;align-items:center;gap:10px;}
    .toggleRow input{transform:scale(1.15);}
    .miniHelp{font-size:12px;opacity:.75;line-height:1.35;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="topbar">
        <div>
          <h1>Vivario</h1>
          <div class="small muted">Questionnaire v1.1</div>
        </div>
        <div id="qCounter" class="small muted"></div>
      </div>

      <div class="qcard">
        <h2 id="qTitle">Chargement…</h2>
        <div id="qText" class="muted" style="display:none"></div>
        <div id="qSubtitle" class="muted" style="line-height:1.55"></div>
        <div id="qHint" class="hint" style="display:none"></div>

        <div id="options" class="qcard"></div>
        <div id="err" class="err"></div>

        <!-- ✅ réglage ton -->
        <div class="miniSettings" aria-label="Réglages">
          <div>
            <div style="font-weight:650;">Ton des scénarios</div>
            <div class="miniHelp">Coach doux = plus enveloppant. Neutre = plus direct mais gentil.</div>
          </div>
          <label class="toggleRow">
            <input type="checkbox" id="optCoachSoft">
            <span>Coach doux</span>
          </label>
        </div>

        <div class="navrow">
          <button id="btnBack" type="button" class="btnLike">← Retour</button>
          <button id="btnNext" type="button" class="btnLike btnPrimary">Continuer →</button>
          <a class="btnLike" href="accueil.html?v=600">Quitter</a>
        </div>

        <div class="sep" style="margin-top:14px"></div>

        <div class="small muted" style="line-height:1.55">
          <b>Confidentialité :</b> Vivario ne remplace pas un professionnel de santé.<br>
          Si tu es en détresse ou en danger immédiat : 15 / 112, ou contacte un proche.
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ sound.js avant engine.js -->
  <script src="sound.js?v=600"></script>
  <script src="engine.js?v=600"></script>

  <script>
    // ✅ Coach doux : persistance
    const KEY_COACH = "vivario_coach_soft";
    document.addEventListener("DOMContentLoaded", () => {
      const cb = document.getElementById("optCoachSoft");
      if (!cb) return;

      cb.checked = localStorage.getItem(KEY_COACH) === "1";
      cb.addEventListener("change", () => {
        localStorage.setItem(KEY_COACH, cb.checked ? "1" : "0");
      });

      // ✅ unlock son au 1er geste (utile sur mobiles)
      const unlock = async () => {
        window.removeEventListener("pointerdown", unlock);
        window.removeEventListener("touchstart", unlock);
        try { await window.VivarioSound?.ensureStarted?.(); } catch {}
      };
      window.addEventListener("pointerdown", unlock, { passive:true });
      window.addEventListener("touchstart", unlock, { passive:true });
    });
  </script>
</body>
</html>