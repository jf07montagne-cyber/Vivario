<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vivario PRO</title>
  <link rel="stylesheet" href="pro_style.css?v=1" />
  <meta name="theme-color" content="#070a12" />
</head>

<body class="pro-page">
  <main class="pro-wrap">
    <header class="pro-top">
      <div class="pro-brandRow">
        <div>
          <h1 class="pro-brand">
            Vivario <span class="pro-badge">PRO</span>
          </h1>
          <p class="pro-muted">
            Diagnostic ‚Ä¢ Modules ‚Ä¢ Plan ‚Ä¢ Suivi ‚Äî tout reste sur ton appareil. Rien n‚Äôest envoy√©.
          </p>
        </div>

        <div class="pro-topActions">
          <a class="pro-btn pro-btnGhost" href="index.html?v=18">‚Ü© Retour</a>
          <a class="pro-btn pro-btnGhost" href="accueil.html?v=18">‚ú® Gratuit</a>
          <a class="pro-btn pro-btnPrimary" href="questionnaire_pro.html?v=1">üöÄ D√©marrer PRO</a>
        </div>
      </div>
    </header>

    <!-- HERO -->
    <section class="pro-hero">
      <div class="pro-heroGlow" aria-hidden="true"></div>

      <div class="pro-heroGrid">
        <div>
          <h2 class="pro-title">Ton espace PRO</h2>
          <p class="pro-lead">
            Un questionnaire plus complet, un diagnostic plus pr√©cis, et un plan guid√©.
            Tu avances sans surcharge : Vivario ajuste la profondeur selon ton √©nergie.
          </p>

          <div class="pro-miniCards">
            <div class="pro-mini">
              <div class="k">üéØ Diagnostic</div>
              <p class="v">
                Une lecture claire de tes domaines prioritaires (scores + signaux).
              </p>
            </div>
            <div class="pro-mini">
              <div class="k">üß© Modules</div>
              <p class="v">
                Exercices concrets (respiration, ancrage, √©criture, mouvement‚Ä¶) selon tes besoins.
              </p>
            </div>
            <div class="pro-mini">
              <div class="k">üìÖ Plan & suivi</div>
              <p class="v">
                Plan du jour (et bient√¥t plan semaine) + check-ins et adh√©rence.
              </p>
            </div>
            <div class="pro-mini">
              <div class="k">üõ°Ô∏è Confidentialit√©</div>
              <p class="v">
                Stockage local, pas de compte obligatoire. Tu gardes le contr√¥le.
              </p>
            </div>
          </div>

          <div class="pro-chips" aria-label="Points forts">
            <span class="pro-chip">Anti-r√©p√©tition</span>
            <span class="pro-chip">Multi-th√®mes</span>
            <span class="pro-chip">Adaptatif</span>
            <span class="pro-chip">Progression</span>
            <span class="pro-chip">Sans tracking</span>
          </div>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="pro-btn pro-btnPrimary" href="questionnaire_pro.html?v=1">üöÄ Commencer le questionnaire PRO</a>
            <a class="pro-btn" href="resultat_pro.html?v=1">üìÑ Voir mon dernier r√©sultat</a>
          </div>

          <p class="pro-muted" style="margin-top:10px;">
            Astuce : si tu veux juste ‚Äúrevenir au calme‚Äù, commence PRO quand tu te sens pr√™t(e) ‚Äî ici, √ßa reste doux.
          </p>
        </div>

        <!-- Right column: status card -->
        <aside class="pro-scoreCard" aria-label="√âtat PRO">
          <div class="pro-scoreHead">
            <div class="pro-scoreLabel">Dernier diagnostic</div>
            <div class="pro-scoreDate" id="proLastDate">‚Äî</div>
          </div>

          <div class="pro-scoreBig">
            <div class="pro-scoreNum" id="proTopScore">‚Äî</div>
            <div class="pro-scoreTxt" id="proTopLabel">Aucun r√©sultat</div>
          </div>

          <div class="pro-scoreList" id="proTopDomains">
            <div class="pro-scoreRow">
              <div class="name">Aucun r√©sultat enregistr√©</div>
              <div class="pro-bar" aria-hidden="true"><i style="width:0%"></i></div>
            </div>
          </div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="pro-btn pro-btnPrimary" href="questionnaire_pro.html?v=1">Relancer PRO</a>
            <button class="pro-btn pro-btnGhost" id="btnClearPro" type="button">R√©initialiser</button>
          </div>

          <p class="pro-muted" style="margin-top:10px;">
            R√©initialiser ne supprime rien ‚Äúen ligne‚Äù : cela efface juste le stockage local sur cet appareil.
          </p>
        </aside>
      </div>
    </section>

    <!-- Quick actions -->
    <section class="pro-card">
      <div class="pro-cardHead">
        <h3 class="pro-h3">Actions rapides</h3>
        <p class="pro-muted" style="margin:0;">
          Revenir √† ton plan ou repartir sur une version ‚Äúrevalidation‚Äù.
        </p>
      </div>

      <div class="pro-planGrid">
        <div class="pro-step">
          <div class="pro-stepHead">
            <div>
              <p class="pro-stepTitle">üìå Continuer</p>
              <p class="pro-muted" style="margin:6px 0 0;">Acc√©der √† ton dernier diagnostic + plan.</p>
            </div>
            <div class="pro-stepMeta">Recommand√©</div>
          </div>
          <a class="pro-btn pro-btnPrimary" href="resultat_pro.html?v=1">Ouvrir mon r√©sultat</a>
        </div>

        <div class="pro-step">
          <div class="pro-stepHead">
            <div>
              <p class="pro-stepTitle">üß† Revalidation</p>
              <p class="pro-muted" style="margin:6px 0 0;">Refaire le parcours pour s‚Äôadapter si √ßa a chang√©.</p>
            </div>
            <div class="pro-stepMeta">Adaptatif</div>
          </div>
          <a class="pro-btn" href="questionnaire_pro.html?v=1">Refaire le questionnaire</a>
        </div>
      </div>
    </section>

    <!-- Premium explanation (tabs) -->
    <section class="pro-card">
      <div class="pro-cardHead">
        <h3 class="pro-h3">Comment √ßa marche</h3>
        <p class="pro-muted" style="margin:0;">Une logique simple : comprendre ‚Üí stabiliser ‚Üí avancer ‚Üí suivre.</p>
      </div>

      <div class="pro-tabs" id="proTabs">
        <button class="pro-tab active" data-pane="diag" type="button">Diagnostic</button>
        <button class="pro-tab" data-pane="plan" type="button">Plan</button>
        <button class="pro-tab" data-pane="suivi" type="button">Suivi</button>
        <button class="pro-tab" data-pane="privacy" type="button">Donn√©es</button>
      </div>

      <div class="pro-pane active" id="pane-diag">
        <p><b>Diagnostic</b> : Vivario agr√®ge tes r√©ponses en domaines (scores 0‚Äì100), puis extrait les priorit√©s.</p>
        <p>Si ton √©nergie est basse, le parcours devient plus court et √©vite les blocs ‚Äúlong/deep‚Äù.</p>
      </div>

      <div class="pro-pane" id="pane-plan">
        <p><b>Plan du jour</b> : s√©lection de modules adapt√©s √† tes priorit√©s, ton √©nergie, et ton rythme r√©cent.</p>
        <p>La s√©lection vise la simplicit√© : 1 √† 3 modules max (plus tard : plan semaine).</p>
      </div>

      <div class="pro-pane" id="pane-suivi">
        <p><b>Suivi</b> : tu coches ce qui est fait, Vivario estime ton adh√©rence et ajuste la difficult√©.</p>
        <p>Prochaine √©tape : une page ‚ÄúSuivi PRO‚Äù d√©di√©e (calendrier + stats + historique check-ins).</p>
      </div>

      <div class="pro-pane" id="pane-privacy">
        <p><b>Confidentialit√©</b> : aucun envoi, aucun tracking. Stockage local uniquement.</p>
        <p>Tu peux r√©initialiser quand tu veux depuis cette page.</p>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const PRO_RESULT_KEY = "vivario_pro_result_v1";

      function escapeHTML(str){
        return String(str || "").replace(/[&<>"']/g, (m) => ({
          "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
        }[m]));
      }

      function prettyDate(iso){
        try{
          const d = new Date(iso);
          return d.toLocaleString(undefined, { year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit" });
        }catch{ return "‚Äî"; }
      }

      function severityLabel(score){
        if (score >= 75) return "√âlev√©";
        if (score >= 45) return "Mod√©r√©";
        if (score >= 20) return "L√©ger";
        return "Faible";
      }

      function topDomains(scores, n){
        const entries = Object.entries(scores || {});
        entries.sort((a,b) => (b[1]||0) - (a[1]||0));
        return entries.slice(0, n).filter(e => (e[1]||0) > 0);
      }

      function render(){
        let data = null;
        try { data = JSON.parse(localStorage.getItem(PRO_RESULT_KEY) || "null"); } catch {}

        const elDate = document.getElementById("proLastDate");
        const elTopScore = document.getElementById("proTopScore");
        const elTopLabel = document.getElementById("proTopLabel");
        const elList = document.getElementById("proTopDomains");

        if (!data){
          elDate.textContent = "‚Äî";
          elTopScore.textContent = "‚Äî";
          elTopLabel.textContent = "Aucun r√©sultat";
          elList.innerHTML = `
            <div class="pro-scoreRow">
              <div class="name">Aucun r√©sultat enregistr√©</div>
              <div class="pro-bar" aria-hidden="true"><i style="width:0%"></i></div>
            </div>`;
          return;
        }

        elDate.textContent = prettyDate(data.created_at);
        const scores = data.scores || {};
        const tops = topDomains(scores, 4);
        const first = tops[0] || ["global", 0];
        elTopScore.textContent = String(first[1] || 0);
        elTopLabel.textContent = `${escapeHTML(first[0])} ‚Ä¢ ${severityLabel(first[1] || 0)}`;

        if (!tops.length){
          elList.innerHTML = `
            <div class="pro-scoreRow">
              <div class="name">Scores non disponibles</div>
              <div class="pro-bar" aria-hidden="true"><i style="width:0%"></i></div>
            </div>`;
          return;
        }

        elList.innerHTML = tops.map(([name, val]) => {
          const w = Math.max(0, Math.min(100, Number(val || 0)));
          return `
            <div class="pro-scoreRow">
              <div class="name">${escapeHTML(name)} ‚Ä¢ ${severityLabel(w)}</div>
              <div class="pro-bar" aria-hidden="true"><i style="width:${w}%"></i></div>
            </div>
          `;
        }).join("");
      }

      // Tabs
      const tabs = document.querySelectorAll(".pro-tab");
      tabs.forEach(btn => {
        btn.addEventListener("click", () => {
          const key = btn.getAttribute("data-pane");
          tabs.forEach(b => b.classList.toggle("active", b === btn));
          ["diag","plan","suivi","privacy"].forEach(k => {
            const pane = document.getElementById("pane-" + k);
            if (pane) pane.classList.toggle("active", k === key);
          });
        });
      });

      // Reset
      const btnClear = document.getElementById("btnClearPro");
      btnClear?.addEventListener("click", () => {
        if (!confirm("R√©initialiser Vivario PRO sur cet appareil ?")) return;
        try { localStorage.removeItem(PRO_RESULT_KEY); } catch {}
        // Optionnel: si tu veux aussi reset state, d√©commente :
        // try { localStorage.removeItem("vivario_pro_state_v1"); } catch {}
        render();
      });

      render();
    })();
  </script>
</body>
</html>